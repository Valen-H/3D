"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var r=0,n=Array(t.length);t.length>r;r++)n[r]=t[r];return n}return Array.from(t)}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function mod(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments[2],e=[r,n].sort(),i=_slicedToArray(e,2);r=i[0],n=i[1];var a=n-r;return r>t?t+a:t>n?t-a:t}function inherit(t,r){for(var n in r)t[n]=r[n];return t}function perm(t){for(var r=[],n=0;t.length>n;n++){var e=perm(t.slice(0,n).concat(t.slice(n+1)));if(e.length)for(var i=0;e.length>i;i++)r.push([t[n]].concat(e[i]));else r.push([t[n]])}return r}function D3test(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.getElementsByTagName("canvas")[0].getContext("2d"),r=new D3Map;return r.addGroup("main",[[5,5,5],[10,-8,-1],[12,7,7]]),r.render(t),r}var _createClass=function(){function t(t,r){for(var n=0;r.length>n;n++){var e=r[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(r,n,e){return n&&t(r.prototype,n),e&&t(r,e),r}}(),_slicedToArray=function(){function t(t,r){var n=[],e=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(e=(o=s.next()).done)&&(n.push(o.value),!r||n.length!==r);e=!0);}catch(u){i=!0,a=u}finally{try{!e&&s["return"]&&s["return"]()}finally{if(i)throw a}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return t(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P2=2*Math.PI,D3Map=function(){function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;_classCallCheck(this,t),this.surface=[0,0,r],this.camera=[0,0,0],this.orientation=[0,0,0],this.pointlist=[],this.groupings=new Map,this.Point=t.Point,this.ConnectGroup=t.ConnectGroup}return _createClass(t,[{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-this.orientation[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.orientation[0]=mod(this.orientation[0]+t,0,P2),this.orientation[1]=mod(this.orientation[1]+r,0,P2),this.orientation[2]=mod(this.orientation[2]+n,0,P2),this}},{key:"translate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-this.camera[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.camera[0]+=t,this.camera[1]+=r,this.camera[2]+=n,this}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return inherit(this.surface,[t,r,n]),this}},{key:"reset",value:function(){return this.orientation=[0,0,0],this.camera=[0,0,0],this}},{key:"add",value:function(){for(var t=this,r=arguments.length,n=Array(r),e=0;r>e;e++)n[e]=arguments[e];if(n.every(function(r){return r instanceof t.Point})){var i=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var h=s.value;this.add(h.x,h.y,h.z)}}catch(l){a=!0,o=l}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}return this}var c=new(Function.prototype.bind.apply(this.Point,[null].concat(n,[this])));return this.pointlist.push(c),c}},{key:"addGroup",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=void 0;this.groupings.set(t,n=new this.ConnectGroup(this));var e=!0,i=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var u=o.value;n.add(u,!1)}}catch(h){i=!0,a=h}finally{try{!e&&s.return&&s.return()}finally{if(i)throw a}}return n.process(),n}},{key:"render",value:function(t,r){if(r)this.groupings.get(r)._render(t);else{var n=!0,e=!1,i=void 0;try{for(var a,o=this.groupings.values()[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s._render(t)}}catch(u){e=!0,i=u}finally{try{!n&&o.return&&o.return()}finally{if(e)throw i}}}return this}}]),t}(),D3Point=function(){function t(r,n,e,i){_classCallCheck(this,t),this.x=r,this.y=n,this.z=e,this.map=i,this._id=this.map.Point.idcnt++}return _createClass(t,[{key:"coords",get:function(){var t=Math.cos(this.map.orientation[0]),r=Math.cos(this.map.orientation[1]),n=Math.cos(this.map.orientation[2]),e=Math.sin(this.map.orientation[0]),i=Math.sin(this.map.orientation[1]),a=Math.sin(this.map.orientation[2]),o=this.x-this.map.camera[0],s=this.y-this.map.camera[1],u=this.z-this.map.camera[2],h=a*s,l=a*o,c=n*o,m=n*s,g=i*u,f=r*u;return[r*(h+c)-g,e*(f+i*(h+c))+t*(m-l),t*(f+i*(h+c))-e*(m-l)]}},{key:"coord2d",get:function(){var t=this.coords,r=this.map.surface[2]/t[2];return[r*t[0]+this.map.surface[0],r*t[1]+this.map.surface[1]]}}]),t}(),D3ConnectGroup=function(){function t(r){_classCallCheck(this,t),this.pointlist=[],this._processed=[],this.map=r,this.render=function(t){return t.fill()}}return _createClass(t,[{key:"add",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0;if(t instanceof this.map.Point&&!this.pointlist.some(function(r){return r._id==t._id}))this.pointlist.push(t);else{var n;this.pointlist.push(t=(n=this.map).add.apply(n,_toConsumableArray(t)))}return r&&this.process(),this}},{key:"process",value:function(){return this._processed=perm(this.pointlist.map(function(t){return t._id}))}},{key:"_render",value:function(t){t.beginPath();var r=!0,n=!1,e=void 0;try{for(var i,a=this._processed[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var o=i.value;for(var s in o)s?t.lineTo.apply(t,_toConsumableArray(this.pointlist[o[s]].coord2d)):t.moveTo.apply(t,_toConsumableArray(this.pointlist[o[s]].coord2d))}}catch(u){n=!0,e=u}finally{try{!r&&a.return&&a.return()}finally{if(n)throw e}}return t.closePath(),this.render(t)}}]),t}();D3Point.idcnt=0,D3Map.Point=D3Point,D3Map.ConnectGroup=D3ConnectGroup;