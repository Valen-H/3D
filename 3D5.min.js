"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);t.length>e;e++)r[e]=t[e];return r}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mod(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments[2],n=[e,r].sort(),a=_slicedToArray(n,2);e=a[0],r=a[1];var i=r-e;return e>t?t+i:t>r?t-i:t}function inherit(t,e){for(var r in e)t[r]=e[r];return t}var _createClass=function(){function t(t,e){for(var r=0;e.length>r;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_slicedToArray=function(){function t(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(u){a=!0,i=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P2=2*Math.PI,D3Map=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;_classCallCheck(this,t),this.surface=[0,0,e],this.camera=[0,0,-e],this.orientation=[0,0,0],this.vertices=[],this.Vertex=t.Vertex,this.Cube=t.Cube,this.RENDER_MODES=t.RENDER_MODES}return _createClass(t,[{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-this.orientation[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.orientation[0]=mod(this.orientation[0]+t,0,P2),this.orientation[1]=mod(this.orientation[1]+e,0,P2),this.orientation[2]=mod(this.orientation[2]+r,0,P2),this}},{key:"translate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-this.camera[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.camera[0]+=t,this.camera[1]+=e,this.camera[2]+=r,this}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.surface[2];return inherit(this.surface,[t,e,r]),this}},{key:"reset",value:function(){return this.orientation=[0,0,0],this.camera=[0,0,0],this}},{key:"add",value:function(){for(var t=this,e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];if(r.every(function(e){return e instanceof t.Vertex})){var a=!0,i=!1,s=void 0;try{for(var o,u=r[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var h=o.value;this.add(h.x,h.y,h.z)}}catch(m){i=!0,s=m}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}return this}var c=new(Function.prototype.bind.apply(this.Vertex,[null].concat(r,[this])));return this.vertices.push(c),c}},{key:"segmentConnect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.vertices,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementsByTagName("canvas")[0].getContext("2d");if(!(e instanceof Array&&e.every(function(e){return e instanceof t.Vertex})))throw"ENOVERTEX";for(var n=0;e.length>n;n++)n&&(e[n].z>this.camera[2]||e[n-1].z>this.camera[2])?r.lineTo.apply(r,_toConsumableArray(e[n].coord2d)):r.moveTo.apply(r,_toConsumableArray(e[n].coord2d));return this}},{key:"field",get:function(){return 2*Math.atan(1/this.surface[2])}}]),t}(),D3Vertex=function(){function t(e,r,n,a){_classCallCheck(this,t),this.x=e,this.y=r,this.z=n,this.map=a,this._id=this.map.Vertex.idcnt++}return _createClass(t,[{key:"coords",get:function(){var t=Math.cos(this.map.orientation[0]),e=Math.cos(this.map.orientation[1]),r=Math.cos(this.map.orientation[2]),n=Math.sin(this.map.orientation[0]),a=Math.sin(this.map.orientation[1]),i=Math.sin(this.map.orientation[2]),s=this.x-this.map.camera[0],o=this.y-this.map.camera[1],u=this.z-this.map.camera[2],h=i*o,m=i*s,c=r*s,l=r*o,g=a*u,f=e*u;return[e*(h+c)-g,n*(f+a*(h+c))+t*(l-m),t*(f+a*(h+c))-n*(l-m)]}},{key:"coord2d",get:function(){var t=this.coords,e=this.map.surface[2]/t[2];return[e*t[0]+this.map.surface[0],e*t[1]+this.map.surface[1]]}}]),t}(),D3Cube=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.indicemap;_classCallCheck(this,t),this.points=e,this.indicemap=r,this.trans=[0,0,0],this.middlew=function(){}}return _createClass(t,[{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D3Map,e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementsByTagName("canvas")[0].getContext("2d"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.RENDER_MODES.BOTH;r.save();var a=this.points.map(function(r){return new t.Vertex(r.x+e.trans[0],r.y+e.trans[1],r.z+e.trans[2],t)}),i=!0,s=!1,o=void 0;try{for(var u,h=this.indicemap[Symbol.iterator]();!(i=(u=h.next()).done);i=!0){var m=u.value;r.beginPath(),t.segmentConnect(m.map(function(t){return a[t]}),r),this.middlew(),r.closePath(),(n&t.RENDER_MODES.STROKE)==t.RENDER_MODES.STROKE&&r.stroke(),(n&t.RENDER_MODES.FILL)==t.RENDER_MODES.FILL&&r.fill()}}catch(c){s=!0,o=c}finally{try{!i&&h.return&&h.return()}finally{if(s)throw o}}return r.restore(),this}}]),t}();D3Cube.indicemap=[[0,1,2,3],[4,5,6,7],[0,1,5,4],[3,2,6,7],[0,4,7,3],[1,5,6,2]],D3Vertex.idcnt=0,D3Map.Vertex=D3Vertex,D3Map.Cube=D3Cube,D3Map.RENDER_MODES={FILL:1,STROKE:2,BOTH:3};