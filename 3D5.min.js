"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);t.length>e;e++)r[e]=t[e];return r}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mod(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments[2],n=[e,r].sort(),a=_slicedToArray(n,2);e=a[0],r=a[1];var i=r-e;return e>t?t+i:t>r?t-i:t}function inherit(t,e){for(var r in e)t[r]=e[r];return t}var _createClass=function(){function t(t,e){for(var r=0;e.length>r;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_slicedToArray=function(){function t(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(u){a=!0,i=u}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw i}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P2=2*Math.PI,D3Map=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementsByTagName("canvas")[0].getContext("2d");_classCallCheck(this,t),this.surface=[0,0,e],this.camera=[0,0,-e],this.size=[r.canvas.width,r.canvas.height],this.orientation=[0,0,0],this.vertices=[],this.Vertex=t.Vertex,this.Cube=t.Cube,this.RENDER_MODES=t.RENDER_MODES}return _createClass(t,[{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-this.orientation[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.orientation[0]=mod(this.orientation[0]+t,0,P2),this.orientation[1]=mod(this.orientation[1]+e,0,P2),this.orientation[2]=mod(this.orientation[2]+r,0,P2),this}},{key:"translate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-this.camera[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.camera[0]+=t,this.camera[1]+=e,this.camera[2]+=r,this}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.surface[2];return inherit(this.surface,[t,e,r]),this}},{key:"reset",value:function(){return this.orientation=[0,0,0],this.camera=[0,0,0],this}},{key:"add",value:function(){for(var t=this,e=arguments.length,r=Array(e),n=0;e>n;n++)r[n]=arguments[n];if(r.every(function(e){return e instanceof t.Vertex})){var a=!0,i=!1,s=void 0;try{for(var o,u=r[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var h=o.value;this.add(h.x,h.y,h.z)}}catch(c){i=!0,s=c}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}return this}var m=new(Function.prototype.bind.apply(this.Vertex,[null].concat(r,[this])));return this.vertices.push(m),m}},{key:"segmentConnect",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.vertices,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementsByTagName("canvas")[0].getContext("2d");if(!(e instanceof Array&&e.every(function(e){return e instanceof t.Vertex})))throw"ENOVERTEX";for(var n=0;e.length>n;n++)if(n&&e[n].coords[2]>0)r.lineTo.apply(r,_toConsumableArray(e[n].coord2d));else if(!n&&e[n].coords[2]>=0)r.moveTo.apply(r,_toConsumableArray(e[n].coord2d));else try{var a=e[n].clip(e[n?n-1:n+1]).coord2d;if(Number.isNaN(a[0])||Number.isNaN(a[1])||!Number.isFinite(a[0])||!Number.isFinite(a[1]))break;n?r.lineTo.apply(r,_toConsumableArray(a)):r.moveTo.apply(r,_toConsumableArray(a))}catch(i){break}return this}},{key:"v0",get:function(){return new D3Vertex(0,0,this.camera[2],this)}},{key:"n",get:function(){var t=[new this.Vertex(-this.size[0]/2,-this.size[1]/2,this.camera[2],this),new this.Vertex(-this.size[0]/2,this.size[1]/2,this.camera[2],this),new this.Vertex(this.size[0]/2,-this.size[1]/2,this.camera[2],this)],e=t[2].sub(t[0]),r=t[1].sub(t[0]),n=e.cross(r);return n}},{key:"field",get:function(){return 2*Math.atan(1/this.surface[2])}}]),t}(),D3Vertex=function(){function t(e,r,n,a){if(_classCallCheck(this,t),e instanceof t){var i=[e.x,e.y,e.z,e.map];e=i[0],r=i[1],n=i[2],a=i[3]}this.x=e,this.y=r,this.z=n,this.map=a,this._id=this.map.Vertex.idcnt++}return _createClass(t,[{key:"clip",value:function(e){if(!(e instanceof t))throw"ENOVERTEX";var r=this.map.v0.sub(e).dot(this.map.n)/this.sub(e).dot(this.map.n),n=this.sub(e);if(0>r||r>1||!this.map.n.dot(n))throw"ENOINTERSCT";return e.add(n.mult(r))}},{key:"add",value:function(e){if(!(e instanceof t))throw"ENOVERTEX";var r=new t(this);return r.x+=e.x,r.y+=e.y,r.z+=e.z,r}},{key:"sub",value:function(e){if(!(e instanceof t))throw"ENOVERTEX";var r=new t(this);return r.x-=e.x,r.y-=e.y,r.z-=e.z,r}},{key:"dot",value:function(e){if(!(e instanceof t))throw"ENOVERTEX";return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"mult",value:function(e){if("string"==typeof e&&/^[0-9]+$/.test(e))e=1*e;else if("number"==typeof e)e=[e,e,e];else if(!(e instanceof Array))throw"EINVALNUM";var r=new t(this);return r.x*=e[0],r.y*=e[1],r.z*=e[2],r}},{key:"cross",value:function(e){if(!(p1 instanceof t))throw"ENOVERTEX";var r=new t(0,0,0,this.map);return r.x=this.y*e.z-this.z*e.y,r.y=this.x*e.z-this.z*e.x,r.z=this.x*e.y-this.y*e.x,r}},{key:"coords",get:function(){var t=Math.cos(this.map.orientation[0]),e=Math.cos(this.map.orientation[1]),r=Math.cos(this.map.orientation[2]),n=Math.sin(this.map.orientation[0]),a=Math.sin(this.map.orientation[1]),i=Math.sin(this.map.orientation[2]),s=this.x-this.map.camera[0],o=this.y-this.map.camera[1],u=this.z-this.map.camera[2],h=i*o,c=i*s,m=r*s,l=r*o,f=a*u,g=e*u;return[e*(h+m)-f,n*(g+a*(h+m))+t*(l-c),t*(g+a*(h+m))-n*(l-c)]}},{key:"scoords",get:function(){return new(Function.prototype.bind.apply(t,[null].concat(_toConsumableArray(this.coords),[this.map])))}},{key:"coord2d",get:function(){var t=this.coords,e=this.map.surface[2]/t[2];return[e*t[0]+this.map.surface[0],e*t[1]+this.map.surface[1]]}}]),t}(),D3Cube=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.matrix;_classCallCheck(this,t),this.points=e,this.matrix=r,this.trans=[0,0,0],this.middlew=function(){}}return _createClass(t,[{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new D3Map,e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.getElementsByTagName("canvas")[0].getContext("2d"),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.RENDER_MODES.BOTH;r.save();var a=this.points.map(function(r){return new t.Vertex(r.x+e.trans[0],r.y+e.trans[1],r.z+e.trans[2],t)}),i=!0,s=!1,o=void 0;try{for(var u,h=this.matrix[Symbol.iterator]();!(i=(u=h.next()).done);i=!0){var c=u.value;r.beginPath(),t.segmentConnect(c.map(function(t){return a[t]}),r),this.middlew(),r.closePath(),(n&t.RENDER_MODES.STROKE)==t.RENDER_MODES.STROKE&&r.stroke(),(n&t.RENDER_MODES.FILL)==t.RENDER_MODES.FILL&&r.fill()}}catch(m){s=!0,o=m}finally{try{!i&&h.return&&h.return()}finally{if(s)throw o}}return r.restore(),this}}]),t}();D3Cube.matrix=[[0,1,2,3],[4,5,6,7],[0,1,5,4],[3,2,6,7],[0,4,7,3],[1,5,6,2]],D3Vertex.idcnt=0,D3Map.Vertex=D3Vertex,D3Map.Cube=D3Cube,D3Map.RENDER_MODES={FILL:1,STROKE:2,BOTH:3};